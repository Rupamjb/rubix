"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/analyze-cube";
exports.ids = ["pages/api/analyze-cube"];
exports.modules = {

/***/ "form-data":
/*!****************************!*\
  !*** external "form-data" ***!
  \****************************/
/***/ ((module) => {

module.exports = require("form-data");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "node-fetch":
/*!*****************************!*\
  !*** external "node-fetch" ***!
  \*****************************/
/***/ ((module) => {

module.exports = require("node-fetch");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "formidable":
/*!*****************************!*\
  !*** external "formidable" ***!
  \*****************************/
/***/ ((module) => {

module.exports = import("formidable");;

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fanalyze-cube&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Canalyze-cube.js&middlewareConfigBase64=e30%3D!":
/*!******************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fanalyze-cube&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Canalyze-cube.js&middlewareConfigBase64=e30%3D! ***!
  \******************************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_analyze_cube_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages\\api\\analyze-cube.js */ \"(api)/./pages/api/analyze-cube.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_pages_api_analyze_cube_js__WEBPACK_IMPORTED_MODULE_3__]);\n_pages_api_analyze_cube_js__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_analyze_cube_js__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_analyze_cube_js__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/analyze-cube\",\n        pathname: \"/api/analyze-cube\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_analyze_cube_js__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRmFuYWx5emUtY3ViZSZwcmVmZXJyZWRSZWdpb249JmFic29sdXRlUGFnZVBhdGg9LiUyRnBhZ2VzJTVDYXBpJTVDYW5hbHl6ZS1jdWJlLmpzJm1pZGRsZXdhcmVDb25maWdCYXNlNjQ9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNMO0FBQzFEO0FBQzBEO0FBQzFEO0FBQ0EsaUVBQWUsd0VBQUssQ0FBQyx1REFBUSxZQUFZLEVBQUM7QUFDMUM7QUFDTyxlQUFlLHdFQUFLLENBQUMsdURBQVE7QUFDcEM7QUFDTyx3QkFBd0IsZ0hBQW1CO0FBQ2xEO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLFlBQVk7QUFDWixDQUFDOztBQUVELHFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vcnViaWstY3ViZS1zb2x2ZXIvP2EzMTEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUGFnZXNBUElSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL3BhZ2VzLWFwaS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBob2lzdCB9IGZyb20gXCJuZXh0L2Rpc3QvYnVpbGQvdGVtcGxhdGVzL2hlbHBlcnNcIjtcbi8vIEltcG9ydCB0aGUgdXNlcmxhbmQgY29kZS5cbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIuL3BhZ2VzXFxcXGFwaVxcXFxhbmFseXplLWN1YmUuanNcIjtcbi8vIFJlLWV4cG9ydCB0aGUgaGFuZGxlciAoc2hvdWxkIGJlIHRoZSBkZWZhdWx0IGV4cG9ydCkuXG5leHBvcnQgZGVmYXVsdCBob2lzdCh1c2VybGFuZCwgXCJkZWZhdWx0XCIpO1xuLy8gUmUtZXhwb3J0IGNvbmZpZy5cbmV4cG9ydCBjb25zdCBjb25maWcgPSBob2lzdCh1c2VybGFuZCwgXCJjb25maWdcIik7XG4vLyBDcmVhdGUgYW5kIGV4cG9ydCB0aGUgcm91dGUgbW9kdWxlIHRoYXQgd2lsbCBiZSBjb25zdW1lZC5cbmV4cG9ydCBjb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBQYWdlc0FQSVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5QQUdFU19BUEksXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9hbmFseXplLWN1YmVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9hbmFseXplLWN1YmVcIixcbiAgICAgICAgLy8gVGhlIGZvbGxvd2luZyBhcmVuJ3QgdXNlZCBpbiBwcm9kdWN0aW9uLlxuICAgICAgICBidW5kbGVQYXRoOiBcIlwiLFxuICAgICAgICBmaWxlbmFtZTogXCJcIlxuICAgIH0sXG4gICAgdXNlcmxhbmRcbn0pO1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1wYWdlcy1hcGkuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fanalyze-cube&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Canalyze-cube.js&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./pages/api/analyze-cube.js":
/*!***********************************!*\
  !*** ./pages/api/analyze-cube.js ***!
  \***********************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var formidable__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! formidable */ \"formidable\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! fs */ \"fs\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var node_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! node-fetch */ \"node-fetch\");\n/* harmony import */ var node_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(node_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var form_data__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! form-data */ \"form-data\");\n/* harmony import */ var form_data__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(form_data__WEBPACK_IMPORTED_MODULE_3__);\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([formidable__WEBPACK_IMPORTED_MODULE_0__]);\nformidable__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\nconst config = {\n    api: {\n        bodyParser: false\n    }\n};\nasync function handler(req, res) {\n    if (req.method !== \"POST\") {\n        return res.status(405).json({\n            error: \"Method not allowed\"\n        });\n    }\n    try {\n        console.log(\"Receiving cube face images...\");\n        // Ensure the temporary upload directory exists\n        const fs = __webpack_require__(/*! fs */ \"fs\");\n        const path = __webpack_require__(/*! path */ \"path\");\n        const uploadDir = path.resolve(\"./tmp\");\n        if (!fs.existsSync(uploadDir)) {\n            fs.mkdirSync(uploadDir, {\n                recursive: true\n            });\n            console.log(`Created temporary upload directory at ${uploadDir}`);\n        }\n        // Parse the multipart form data with improved options\n        const form = (0,formidable__WEBPACK_IMPORTED_MODULE_0__[\"default\"])({\n            keepExtensions: true,\n            multiples: true,\n            maxFileSize: 5 * 1024 * 1024,\n            allowEmptyFiles: false,\n            uploadDir,\n            filename: (_name, _ext, part)=>{\n                // Use the original filename if available\n                return part.originalFilename || `upload_${Date.now()}`;\n            }\n        });\n        // Parse form data with proper error handling\n        const [fields, files] = await new Promise((resolve, reject)=>{\n            form.parse(req, (err, fields, files)=>{\n                if (err) {\n                    console.error(\"Form parsing error:\", err);\n                    reject(new Error(`Failed to parse form data: ${err.message}`));\n                } else {\n                    // Debug log the parsed files\n                    console.log(\"Parsed form data:\", {\n                        fields: Object.keys(fields),\n                        files: Object.keys(files),\n                        fileDetails: Object.entries(files).map(([key, file])=>({\n                                key,\n                                filename: file.originalFilename,\n                                filepath: file.filepath,\n                                type: file.mimetype,\n                                size: file.size\n                            }))\n                    });\n                    resolve([\n                        fields,\n                        files\n                    ]);\n                }\n            });\n        });\n        console.log(\"Received files:\", Object.keys(files));\n        // Required face names and validation\n        const requiredFaces = [\n            \"U\",\n            \"R\",\n            \"F\",\n            \"D\",\n            \"L\",\n            \"B\"\n        ];\n        const missingFaces = requiredFaces.filter((face)=>!files[face]);\n        if (missingFaces.length > 0) {\n            console.error(\"Missing faces:\", missingFaces);\n            return res.status(400).json({\n                error: \"Missing faces\",\n                details: `Missing faces: ${missingFaces.join(\", \")}`\n            });\n        }\n        // Create form data for backend request\n        const backendFormData = new (form_data__WEBPACK_IMPORTED_MODULE_3___default())();\n        // Add files to form data with validation\n        for (const face of requiredFaces){\n            const file = files[face];\n            // Handle potential array of files from formidable\n            const fileData = Array.isArray(file) ? file[0] : file;\n            if (!fileData) {\n                throw new Error(`Missing file for face ${face}`);\n            }\n            console.log(`File details for face ${face}:`, {\n                originalFilename: fileData.originalFilename,\n                filepath: fileData.filepath,\n                mimetype: fileData.mimetype,\n                size: fileData.size\n            });\n            // Get file type from various possible sources\n            let fileType = fileData.mimetype;\n            if (!fileType && fileData.originalFilename) {\n                // Try to detect from file extension\n                const ext = fileData.originalFilename.split(\".\").pop()?.toLowerCase();\n                const mimeTypes = {\n                    \"jpg\": \"image/jpeg\",\n                    \"jpeg\": \"image/jpeg\",\n                    \"png\": \"image/png\",\n                    \"gif\": \"image/gif\",\n                    \"webp\": \"image/webp\"\n                };\n                fileType = mimeTypes[ext];\n                if (fileType) {\n                    console.log(`Detected MIME type from extension for face ${face}:`, {\n                        ext,\n                        fileType\n                    });\n                }\n            }\n            // If still no file type, try reading the first few bytes to detect image type\n            if (!fileType && fileData.filepath) {\n                try {\n                    const fs = __webpack_require__(/*! fs */ \"fs\");\n                    const buffer = fs.readFileSync(fileData.filepath, {\n                        length: 12\n                    });\n                    // Magic numbers for common image formats\n                    if (buffer[0] === 0xFF && buffer[1] === 0xD8) fileType = \"image/jpeg\";\n                    else if (buffer[0] === 0x89 && buffer[1] === 0x50) fileType = \"image/png\";\n                    else if (buffer[0] === 0x47 && buffer[1] === 0x49) fileType = \"image/gif\";\n                    if (fileType) {\n                        console.log(`Detected MIME type from file content for face ${face}:`, {\n                            fileType\n                        });\n                    }\n                } catch (error) {\n                    console.error(`Failed to read file content for type detection:`, error);\n                }\n            }\n            const validTypes = [\n                \"image/jpeg\",\n                \"image/png\",\n                \"image/gif\",\n                \"image/webp\"\n            ];\n            if (!fileType || !validTypes.includes(fileType.toLowerCase())) {\n                console.error(`Invalid file type for face ${face}:`, {\n                    fileType,\n                    validTypes\n                });\n                throw new Error(`Invalid file type for face ${face}. Got: ${fileType || \"unknown\"}. Supported types: JPG, PNG, GIF, WebP`);\n            }\n            console.log(`Processing file for face ${face}:`, {\n                name: file.originalFilename,\n                type: fileType,\n                size: file.size\n            });\n            // Always use fileData.filepath and guard against undefined\n            if (!fileData.filepath) {\n                throw new Error(`File for face ${face} does not have a valid filepath. Cannot create read stream.`);\n            }\n            try {\n                const stream = (0,fs__WEBPACK_IMPORTED_MODULE_1__.createReadStream)(fileData.filepath);\n                backendFormData.append(face, stream, {\n                    filename: fileData.originalFilename,\n                    contentType: fileType\n                });\n            } catch (error) {\n                console.error(`Error processing file for face ${face}:`, error);\n                throw new Error(`Failed to process file for face ${face}: ${error.message}`);\n            }\n            // Enhanced fallback for undefined filepath\n            if (!fileData.filepath) {\n                console.error(`Filepath is undefined for face ${face}. Attempting to handle in-memory buffer.`);\n                // Check if formidable provides a buffer\n                const buffer = fileData._writeStream?.buffer || fileData.toJSON?.().buffer;\n                if (!buffer) {\n                    throw new Error(`Failed to process file for face ${face}: No valid filepath or buffer available.`);\n                }\n                // Save the buffer to a temporary file\n                const tempFilePath = path.join(uploadDir, `${face}_temp_${Date.now()}.png`);\n                try {\n                    fs.writeFileSync(tempFilePath, buffer);\n                    fileData.filepath = tempFilePath;\n                    console.log(`Saved in-memory buffer to temporary file: ${tempFilePath}`);\n                } catch (error) {\n                    console.error(`Failed to save in-memory buffer to temporary file for face ${face}:`, error);\n                    throw new Error(`Failed to save buffer for face ${face}: ${error.message}`);\n                }\n            }\n        }\n        // Forward to FastAPI backend with timeout\n        console.log(\"Forwarding files to backend\");\n        const controller = new AbortController();\n        const timeout = setTimeout(()=>controller.abort(), 30000); // 30 second timeout\n        try {\n            const response = await node_fetch__WEBPACK_IMPORTED_MODULE_2___default()(\"http://127.0.0.1:8000/api/analyze-cube\", {\n                method: \"POST\",\n                body: backendFormData,\n                headers: backendFormData.getHeaders(),\n                signal: controller.signal\n            });\n            clearTimeout(timeout);\n            // Get response as text first\n            const responseText = await response.text();\n            console.log(\"Backend response status:\", response.status);\n            console.log(\"Backend response:\", responseText);\n            // Parse JSON response\n            let responseData;\n            try {\n                responseData = JSON.parse(responseText);\n            } catch (e) {\n                console.error(\"Failed to parse response as JSON:\", e);\n                throw new Error(\"Invalid JSON response from backend\");\n            }\n            // Check for error response\n            if (!response.ok) {\n                throw new Error(responseData.detail || \"Backend error\");\n            }\n            // Return success response\n            return res.status(200).json(responseData);\n        } catch (error) {\n            if (error.name === \"AbortError\") {\n                throw new Error(\"Backend request timed out after 30 seconds\");\n            }\n            throw error;\n        }\n    } catch (error) {\n        console.error(\"Error in API route:\", error);\n        return res.status(500).json({\n            error: \"Failed to process request\",\n            details: error.message\n        });\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QixPQUFPNUYsSUFBSUUsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQ3FGO1FBRTlCLEVBQUUsT0FBT3BGLE9BQU87WUFDZCxJQUFJQSxNQUFNK0QsSUFBSSxLQUFLLGNBQWM7Z0JBQy9CLE1BQU0sSUFBSWxDLE1BQU07WUFDbEI7WUFDQSxNQUFNN0I7UUFDUjtJQUVGLEVBQUUsT0FBT0EsT0FBTztRQUNkQyxRQUFRRCxLQUFLLENBQUMsdUJBQXVCQTtRQUNyQyxPQUFPSixJQUFJRSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO1lBQzFCQyxPQUFPO1lBQ1ArQyxTQUFTL0MsTUFBTThCLE9BQU87UUFDeEI7SUFDRjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vcnViaWstY3ViZS1zb2x2ZXIvLi9wYWdlcy9hcGkvYW5hbHl6ZS1jdWJlLmpzP2NhMzgiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGZvcm1pZGFibGUgZnJvbSAnZm9ybWlkYWJsZSc7XHJcbmltcG9ydCB7IGNyZWF0ZVJlYWRTdHJlYW0gfSBmcm9tICdmcyc7XHJcbmltcG9ydCBmZXRjaCBmcm9tICdub2RlLWZldGNoJztcclxuaW1wb3J0IEZvcm1EYXRhIGZyb20gJ2Zvcm0tZGF0YSc7XHJcblxyXG5leHBvcnQgY29uc3QgY29uZmlnID0ge1xyXG4gIGFwaToge1xyXG4gICAgYm9keVBhcnNlcjogZmFsc2UsXHJcbiAgfSxcclxufTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZXIocmVxLCByZXMpIHtcclxuICBpZiAocmVxLm1ldGhvZCAhPT0gJ1BPU1QnKSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDUpLmpzb24oeyBlcnJvcjogJ01ldGhvZCBub3QgYWxsb3dlZCcgfSk7XHJcbiAgfVxyXG5cclxuICB0cnkge1xyXG4gICAgY29uc29sZS5sb2coJ1JlY2VpdmluZyBjdWJlIGZhY2UgaW1hZ2VzLi4uJyk7XHJcbiAgICBcclxuICAgIC8vIEVuc3VyZSB0aGUgdGVtcG9yYXJ5IHVwbG9hZCBkaXJlY3RvcnkgZXhpc3RzXHJcbiAgICBjb25zdCBmcyA9IHJlcXVpcmUoJ2ZzJyk7XHJcbiAgICBjb25zdCBwYXRoID0gcmVxdWlyZSgncGF0aCcpO1xyXG4gICAgY29uc3QgdXBsb2FkRGlyID0gcGF0aC5yZXNvbHZlKCcuL3RtcCcpO1xyXG5cclxuICAgIGlmICghZnMuZXhpc3RzU3luYyh1cGxvYWREaXIpKSB7XHJcbiAgICAgIGZzLm1rZGlyU3luYyh1cGxvYWREaXIsIHsgcmVjdXJzaXZlOiB0cnVlIH0pO1xyXG4gICAgICBjb25zb2xlLmxvZyhgQ3JlYXRlZCB0ZW1wb3JhcnkgdXBsb2FkIGRpcmVjdG9yeSBhdCAke3VwbG9hZERpcn1gKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBQYXJzZSB0aGUgbXVsdGlwYXJ0IGZvcm0gZGF0YSB3aXRoIGltcHJvdmVkIG9wdGlvbnNcclxuICAgIGNvbnN0IGZvcm0gPSBmb3JtaWRhYmxlKHtcclxuICAgICAga2VlcEV4dGVuc2lvbnM6IHRydWUsXHJcbiAgICAgIG11bHRpcGxlczogdHJ1ZSwgLy8gQ2hhbmdlZCB0byB0cnVlIHRvIGhhbmRsZSBhcnJheSBvZiBmaWxlc1xyXG4gICAgICBtYXhGaWxlU2l6ZTogNSAqIDEwMjQgKiAxMDI0LCAvLyA1TUIgbWF4IGZpbGUgc2l6ZVxyXG4gICAgICBhbGxvd0VtcHR5RmlsZXM6IGZhbHNlLFxyXG4gICAgICB1cGxvYWREaXIsIC8vIFVzZSB0aGUgZW5zdXJlZCB0ZW1wb3JhcnkgZGlyZWN0b3J5XHJcbiAgICAgIGZpbGVuYW1lOiAoX25hbWUsIF9leHQsIHBhcnQpID0+IHtcclxuICAgICAgICAvLyBVc2UgdGhlIG9yaWdpbmFsIGZpbGVuYW1lIGlmIGF2YWlsYWJsZVxyXG4gICAgICAgIHJldHVybiBwYXJ0Lm9yaWdpbmFsRmlsZW5hbWUgfHwgYHVwbG9hZF8ke0RhdGUubm93KCl9YDtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICBcclxuICAgIC8vIFBhcnNlIGZvcm0gZGF0YSB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZ1xyXG4gICAgY29uc3QgW2ZpZWxkcywgZmlsZXNdID0gYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICBmb3JtLnBhcnNlKHJlcSwgKGVyciwgZmllbGRzLCBmaWxlcykgPT4ge1xyXG4gICAgICAgIGlmIChlcnIpIHtcclxuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Zvcm0gcGFyc2luZyBlcnJvcjonLCBlcnIpO1xyXG4gICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcihgRmFpbGVkIHRvIHBhcnNlIGZvcm0gZGF0YTogJHtlcnIubWVzc2FnZX1gKSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIC8vIERlYnVnIGxvZyB0aGUgcGFyc2VkIGZpbGVzXHJcbiAgICAgICAgICBjb25zb2xlLmxvZygnUGFyc2VkIGZvcm0gZGF0YTonLCB7XHJcbiAgICAgICAgICAgIGZpZWxkczogT2JqZWN0LmtleXMoZmllbGRzKSxcclxuICAgICAgICAgICAgZmlsZXM6IE9iamVjdC5rZXlzKGZpbGVzKSxcclxuICAgICAgICAgICAgZmlsZURldGFpbHM6IE9iamVjdC5lbnRyaWVzKGZpbGVzKS5tYXAoKFtrZXksIGZpbGVdKSA9PiAoe1xyXG4gICAgICAgICAgICAgIGtleSxcclxuICAgICAgICAgICAgICBmaWxlbmFtZTogZmlsZS5vcmlnaW5hbEZpbGVuYW1lLFxyXG4gICAgICAgICAgICAgIGZpbGVwYXRoOiBmaWxlLmZpbGVwYXRoLFxyXG4gICAgICAgICAgICAgIHR5cGU6IGZpbGUubWltZXR5cGUsXHJcbiAgICAgICAgICAgICAgc2l6ZTogZmlsZS5zaXplXHJcbiAgICAgICAgICAgIH0pKVxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgICByZXNvbHZlKFtmaWVsZHMsIGZpbGVzXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnNvbGUubG9nKCdSZWNlaXZlZCBmaWxlczonLCBPYmplY3Qua2V5cyhmaWxlcykpO1xyXG4gICAgXHJcbiAgICAvLyBSZXF1aXJlZCBmYWNlIG5hbWVzIGFuZCB2YWxpZGF0aW9uXHJcbiAgICBjb25zdCByZXF1aXJlZEZhY2VzID0gWydVJywgJ1InLCAnRicsICdEJywgJ0wnLCAnQiddO1xyXG4gICAgY29uc3QgbWlzc2luZ0ZhY2VzID0gcmVxdWlyZWRGYWNlcy5maWx0ZXIoZmFjZSA9PiAhZmlsZXNbZmFjZV0pO1xyXG4gICAgXHJcbiAgICBpZiAobWlzc2luZ0ZhY2VzLmxlbmd0aCA+IDApIHtcclxuICAgICAgY29uc29sZS5lcnJvcignTWlzc2luZyBmYWNlczonLCBtaXNzaW5nRmFjZXMpO1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xyXG4gICAgICAgIGVycm9yOiAnTWlzc2luZyBmYWNlcycsXHJcbiAgICAgICAgZGV0YWlsczogYE1pc3NpbmcgZmFjZXM6ICR7bWlzc2luZ0ZhY2VzLmpvaW4oJywgJyl9YFxyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBDcmVhdGUgZm9ybSBkYXRhIGZvciBiYWNrZW5kIHJlcXVlc3RcclxuICAgIGNvbnN0IGJhY2tlbmRGb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xyXG4gICAgXHJcbiAgICAvLyBBZGQgZmlsZXMgdG8gZm9ybSBkYXRhIHdpdGggdmFsaWRhdGlvblxyXG4gICAgZm9yIChjb25zdCBmYWNlIG9mIHJlcXVpcmVkRmFjZXMpIHtcclxuICAgICAgY29uc3QgZmlsZSA9IGZpbGVzW2ZhY2VdO1xyXG4gICAgICBcclxuICAgICAgLy8gSGFuZGxlIHBvdGVudGlhbCBhcnJheSBvZiBmaWxlcyBmcm9tIGZvcm1pZGFibGVcclxuICAgICAgY29uc3QgZmlsZURhdGEgPSBBcnJheS5pc0FycmF5KGZpbGUpID8gZmlsZVswXSA6IGZpbGU7XHJcbiAgICAgIFxyXG4gICAgICBpZiAoIWZpbGVEYXRhKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBNaXNzaW5nIGZpbGUgZm9yIGZhY2UgJHtmYWNlfWApO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zb2xlLmxvZyhgRmlsZSBkZXRhaWxzIGZvciBmYWNlICR7ZmFjZX06YCwge1xyXG4gICAgICAgIG9yaWdpbmFsRmlsZW5hbWU6IGZpbGVEYXRhLm9yaWdpbmFsRmlsZW5hbWUsXHJcbiAgICAgICAgZmlsZXBhdGg6IGZpbGVEYXRhLmZpbGVwYXRoLFxyXG4gICAgICAgIG1pbWV0eXBlOiBmaWxlRGF0YS5taW1ldHlwZSxcclxuICAgICAgICBzaXplOiBmaWxlRGF0YS5zaXplXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgLy8gR2V0IGZpbGUgdHlwZSBmcm9tIHZhcmlvdXMgcG9zc2libGUgc291cmNlc1xyXG4gICAgICBsZXQgZmlsZVR5cGUgPSBmaWxlRGF0YS5taW1ldHlwZTtcclxuICAgICAgXHJcbiAgICAgIGlmICghZmlsZVR5cGUgJiYgZmlsZURhdGEub3JpZ2luYWxGaWxlbmFtZSkge1xyXG4gICAgICAgIC8vIFRyeSB0byBkZXRlY3QgZnJvbSBmaWxlIGV4dGVuc2lvblxyXG4gICAgICAgIGNvbnN0IGV4dCA9IGZpbGVEYXRhLm9yaWdpbmFsRmlsZW5hbWUuc3BsaXQoJy4nKS5wb3AoKT8udG9Mb3dlckNhc2UoKTtcclxuICAgICAgICBjb25zdCBtaW1lVHlwZXMgPSB7XHJcbiAgICAgICAgICAnanBnJzogJ2ltYWdlL2pwZWcnLFxyXG4gICAgICAgICAgJ2pwZWcnOiAnaW1hZ2UvanBlZycsXHJcbiAgICAgICAgICAncG5nJzogJ2ltYWdlL3BuZycsXHJcbiAgICAgICAgICAnZ2lmJzogJ2ltYWdlL2dpZicsXHJcbiAgICAgICAgICAnd2VicCc6ICdpbWFnZS93ZWJwJ1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgZmlsZVR5cGUgPSBtaW1lVHlwZXNbZXh0XTtcclxuICAgICAgICBcclxuICAgICAgICBpZiAoZmlsZVR5cGUpIHtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKGBEZXRlY3RlZCBNSU1FIHR5cGUgZnJvbSBleHRlbnNpb24gZm9yIGZhY2UgJHtmYWNlfTpgLCB7IGV4dCwgZmlsZVR5cGUgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICAvLyBJZiBzdGlsbCBubyBmaWxlIHR5cGUsIHRyeSByZWFkaW5nIHRoZSBmaXJzdCBmZXcgYnl0ZXMgdG8gZGV0ZWN0IGltYWdlIHR5cGVcclxuICAgICAgaWYgKCFmaWxlVHlwZSAmJiBmaWxlRGF0YS5maWxlcGF0aCkge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICBjb25zdCBmcyA9IHJlcXVpcmUoJ2ZzJyk7XHJcbiAgICAgICAgICBjb25zdCBidWZmZXIgPSBmcy5yZWFkRmlsZVN5bmMoZmlsZURhdGEuZmlsZXBhdGgsIHsgbGVuZ3RoOiAxMiB9KTtcclxuICAgICAgICAgIFxyXG4gICAgICAgICAgLy8gTWFnaWMgbnVtYmVycyBmb3IgY29tbW9uIGltYWdlIGZvcm1hdHNcclxuICAgICAgICAgIGlmIChidWZmZXJbMF0gPT09IDB4RkYgJiYgYnVmZmVyWzFdID09PSAweEQ4KSBmaWxlVHlwZSA9ICdpbWFnZS9qcGVnJztcclxuICAgICAgICAgIGVsc2UgaWYgKGJ1ZmZlclswXSA9PT0gMHg4OSAmJiBidWZmZXJbMV0gPT09IDB4NTApIGZpbGVUeXBlID0gJ2ltYWdlL3BuZyc7XHJcbiAgICAgICAgICBlbHNlIGlmIChidWZmZXJbMF0gPT09IDB4NDcgJiYgYnVmZmVyWzFdID09PSAweDQ5KSBmaWxlVHlwZSA9ICdpbWFnZS9naWYnO1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgICBpZiAoZmlsZVR5cGUpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coYERldGVjdGVkIE1JTUUgdHlwZSBmcm9tIGZpbGUgY29udGVudCBmb3IgZmFjZSAke2ZhY2V9OmAsIHsgZmlsZVR5cGUgfSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEZhaWxlZCB0byByZWFkIGZpbGUgY29udGVudCBmb3IgdHlwZSBkZXRlY3Rpb246YCwgZXJyb3IpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgY29uc3QgdmFsaWRUeXBlcyA9IFsnaW1hZ2UvanBlZycsICdpbWFnZS9wbmcnLCAnaW1hZ2UvZ2lmJywgJ2ltYWdlL3dlYnAnXTtcclxuICAgICAgaWYgKCFmaWxlVHlwZSB8fCAhdmFsaWRUeXBlcy5pbmNsdWRlcyhmaWxlVHlwZS50b0xvd2VyQ2FzZSgpKSkge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYEludmFsaWQgZmlsZSB0eXBlIGZvciBmYWNlICR7ZmFjZX06YCwgeyBmaWxlVHlwZSwgdmFsaWRUeXBlcyB9KTtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgZmlsZSB0eXBlIGZvciBmYWNlICR7ZmFjZX0uIEdvdDogJHtmaWxlVHlwZSB8fCAndW5rbm93bid9LiBTdXBwb3J0ZWQgdHlwZXM6IEpQRywgUE5HLCBHSUYsIFdlYlBgKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc29sZS5sb2coYFByb2Nlc3NpbmcgZmlsZSBmb3IgZmFjZSAke2ZhY2V9OmAsIHtcclxuICAgICAgICBuYW1lOiBmaWxlLm9yaWdpbmFsRmlsZW5hbWUsXHJcbiAgICAgICAgdHlwZTogZmlsZVR5cGUsXHJcbiAgICAgICAgc2l6ZTogZmlsZS5zaXplXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgLy8gQWx3YXlzIHVzZSBmaWxlRGF0YS5maWxlcGF0aCBhbmQgZ3VhcmQgYWdhaW5zdCB1bmRlZmluZWRcclxuICAgICAgaWYgKCFmaWxlRGF0YS5maWxlcGF0aCkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgRmlsZSBmb3IgZmFjZSAke2ZhY2V9IGRvZXMgbm90IGhhdmUgYSB2YWxpZCBmaWxlcGF0aC4gQ2Fubm90IGNyZWF0ZSByZWFkIHN0cmVhbS5gKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgdHJ5IHtcclxuICAgICAgICBjb25zdCBzdHJlYW0gPSBjcmVhdGVSZWFkU3RyZWFtKGZpbGVEYXRhLmZpbGVwYXRoKTtcclxuICAgICAgICBiYWNrZW5kRm9ybURhdGEuYXBwZW5kKGZhY2UsIHN0cmVhbSwge1xyXG4gICAgICAgICAgZmlsZW5hbWU6IGZpbGVEYXRhLm9yaWdpbmFsRmlsZW5hbWUsXHJcbiAgICAgICAgICBjb250ZW50VHlwZTogZmlsZVR5cGUsXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihgRXJyb3IgcHJvY2Vzc2luZyBmaWxlIGZvciBmYWNlICR7ZmFjZX06YCwgZXJyb3IpO1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIHByb2Nlc3MgZmlsZSBmb3IgZmFjZSAke2ZhY2V9OiAke2Vycm9yLm1lc3NhZ2V9YCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIEVuaGFuY2VkIGZhbGxiYWNrIGZvciB1bmRlZmluZWQgZmlsZXBhdGhcclxuICAgICAgaWYgKCFmaWxlRGF0YS5maWxlcGF0aCkge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYEZpbGVwYXRoIGlzIHVuZGVmaW5lZCBmb3IgZmFjZSAke2ZhY2V9LiBBdHRlbXB0aW5nIHRvIGhhbmRsZSBpbi1tZW1vcnkgYnVmZmVyLmApO1xyXG5cclxuICAgICAgICAvLyBDaGVjayBpZiBmb3JtaWRhYmxlIHByb3ZpZGVzIGEgYnVmZmVyXHJcbiAgICAgICAgY29uc3QgYnVmZmVyID0gZmlsZURhdGEuX3dyaXRlU3RyZWFtPy5idWZmZXIgfHwgZmlsZURhdGEudG9KU09OPy4oKS5idWZmZXI7XHJcbiAgICAgICAgaWYgKCFidWZmZXIpIHtcclxuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIHByb2Nlc3MgZmlsZSBmb3IgZmFjZSAke2ZhY2V9OiBObyB2YWxpZCBmaWxlcGF0aCBvciBidWZmZXIgYXZhaWxhYmxlLmApO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gU2F2ZSB0aGUgYnVmZmVyIHRvIGEgdGVtcG9yYXJ5IGZpbGVcclxuICAgICAgICBjb25zdCB0ZW1wRmlsZVBhdGggPSBwYXRoLmpvaW4odXBsb2FkRGlyLCBgJHtmYWNlfV90ZW1wXyR7RGF0ZS5ub3coKX0ucG5nYCk7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgIGZzLndyaXRlRmlsZVN5bmModGVtcEZpbGVQYXRoLCBidWZmZXIpO1xyXG4gICAgICAgICAgZmlsZURhdGEuZmlsZXBhdGggPSB0ZW1wRmlsZVBhdGg7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZyhgU2F2ZWQgaW4tbWVtb3J5IGJ1ZmZlciB0byB0ZW1wb3JhcnkgZmlsZTogJHt0ZW1wRmlsZVBhdGh9YCk7XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEZhaWxlZCB0byBzYXZlIGluLW1lbW9yeSBidWZmZXIgdG8gdGVtcG9yYXJ5IGZpbGUgZm9yIGZhY2UgJHtmYWNlfTpgLCBlcnJvcik7XHJcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBzYXZlIGJ1ZmZlciBmb3IgZmFjZSAke2ZhY2V9OiAke2Vycm9yLm1lc3NhZ2V9YCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gRm9yd2FyZCB0byBGYXN0QVBJIGJhY2tlbmQgd2l0aCB0aW1lb3V0XHJcbiAgICBjb25zb2xlLmxvZygnRm9yd2FyZGluZyBmaWxlcyB0byBiYWNrZW5kJyk7XHJcbiAgICBjb25zdCBjb250cm9sbGVyID0gbmV3IEFib3J0Q29udHJvbGxlcigpO1xyXG4gICAgY29uc3QgdGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4gY29udHJvbGxlci5hYm9ydCgpLCAzMDAwMCk7IC8vIDMwIHNlY29uZCB0aW1lb3V0XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCgnaHR0cDovLzEyNy4wLjAuMTo4MDAwL2FwaS9hbmFseXplLWN1YmUnLCB7XHJcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgYm9keTogYmFja2VuZEZvcm1EYXRhLFxyXG4gICAgICAgIGhlYWRlcnM6IGJhY2tlbmRGb3JtRGF0YS5nZXRIZWFkZXJzKCksXHJcbiAgICAgICAgc2lnbmFsOiBjb250cm9sbGVyLnNpZ25hbFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0KTtcclxuXHJcbiAgICAgIC8vIEdldCByZXNwb25zZSBhcyB0ZXh0IGZpcnN0XHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlVGV4dCA9IGF3YWl0IHJlc3BvbnNlLnRleHQoKTtcclxuICAgICAgY29uc29sZS5sb2coJ0JhY2tlbmQgcmVzcG9uc2Ugc3RhdHVzOicsIHJlc3BvbnNlLnN0YXR1cyk7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdCYWNrZW5kIHJlc3BvbnNlOicsIHJlc3BvbnNlVGV4dCk7XHJcblxyXG4gICAgICAvLyBQYXJzZSBKU09OIHJlc3BvbnNlXHJcbiAgICAgIGxldCByZXNwb25zZURhdGE7XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgcmVzcG9uc2VEYXRhID0gSlNPTi5wYXJzZShyZXNwb25zZVRleHQpO1xyXG4gICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIHBhcnNlIHJlc3BvbnNlIGFzIEpTT046JywgZSk7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIEpTT04gcmVzcG9uc2UgZnJvbSBiYWNrZW5kJyk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIENoZWNrIGZvciBlcnJvciByZXNwb25zZVxyXG4gICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKHJlc3BvbnNlRGF0YS5kZXRhaWwgfHwgJ0JhY2tlbmQgZXJyb3InKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gUmV0dXJuIHN1Y2Nlc3MgcmVzcG9uc2VcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHJlc3BvbnNlRGF0YSk7XHJcblxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgaWYgKGVycm9yLm5hbWUgPT09ICdBYm9ydEVycm9yJykge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignQmFja2VuZCByZXF1ZXN0IHRpbWVkIG91dCBhZnRlciAzMCBzZWNvbmRzJyk7XHJcbiAgICAgIH1cclxuICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICB9XHJcblxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBBUEkgcm91dGU6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgZXJyb3I6ICdGYWlsZWQgdG8gcHJvY2VzcyByZXF1ZXN0JyxcclxuICAgICAgZGV0YWlsczogZXJyb3IubWVzc2FnZVxyXG4gICAgfSk7XHJcbiAgfVxyXG59XHJcbiJdLCJuYW1lcyI6WyJmb3JtaWRhYmxlIiwiY3JlYXRlUmVhZFN0cmVhbSIsImZldGNoIiwiRm9ybURhdGEiLCJjb25maWciLCJhcGkiLCJib2R5UGFyc2VyIiwiaGFuZGxlciIsInJlcSIsInJlcyIsIm1ldGhvZCIsInN0YXR1cyIsImpzb24iLCJlcnJvciIsImNvbnNvbGUiLCJsb2ciLCJmcyIsInJlcXVpcmUiLCJwYXRoIiwidXBsb2FkRGlyIiwicmVzb2x2ZSIsImV4aXN0c1N5bmMiLCJta2RpclN5bmMiLCJyZWN1cnNpdmUiLCJmb3JtIiwia2VlcEV4dGVuc2lvbnMiLCJtdWx0aXBsZXMiLCJtYXhGaWxlU2l6ZSIsImFsbG93RW1wdHlGaWxlcyIsImZpbGVuYW1lIiwiX25hbWUiLCJfZXh0IiwicGFydCIsIm9yaWdpbmFsRmlsZW5hbWUiLCJEYXRlIiwibm93IiwiZmllbGRzIiwiZmlsZXMiLCJQcm9taXNlIiwicmVqZWN0IiwicGFyc2UiLCJlcnIiLCJFcnJvciIsIm1lc3NhZ2UiLCJPYmplY3QiLCJrZXlzIiwiZmlsZURldGFpbHMiLCJlbnRyaWVzIiwibWFwIiwia2V5IiwiZmlsZSIsImZpbGVwYXRoIiwidHlwZSIsIm1pbWV0eXBlIiwic2l6ZSIsInJlcXVpcmVkRmFjZXMiLCJtaXNzaW5nRmFjZXMiLCJmaWx0ZXIiLCJmYWNlIiwibGVuZ3RoIiwiZGV0YWlscyIsImpvaW4iLCJiYWNrZW5kRm9ybURhdGEiLCJmaWxlRGF0YSIsIkFycmF5IiwiaXNBcnJheSIsImZpbGVUeXBlIiwiZXh0Iiwic3BsaXQiLCJwb3AiLCJ0b0xvd2VyQ2FzZSIsIm1pbWVUeXBlcyIsImJ1ZmZlciIsInJlYWRGaWxlU3luYyIsInZhbGlkVHlwZXMiLCJpbmNsdWRlcyIsIm5hbWUiLCJzdHJlYW0iLCJhcHBlbmQiLCJjb250ZW50VHlwZSIsIl93cml0ZVN0cmVhbSIsInRvSlNPTiIsInRlbXBGaWxlUGF0aCIsIndyaXRlRmlsZVN5bmMiLCJjb250cm9sbGVyIiwiQWJvcnRDb250cm9sbGVyIiwidGltZW91dCIsInNldFRpbWVvdXQiLCJhYm9ydCIsInJlc3BvbnNlIiwiYm9keSIsImhlYWRlcnMiLCJnZXRIZWFkZXJzIiwic2lnbmFsIiwiY2xlYXJUaW1lb3V0IiwicmVzcG9uc2VUZXh0IiwidGV4dCIsInJlc3BvbnNlRGF0YSIsIkpTT04iLCJlIiwib2siLCJkZXRhaWwiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./pages/api/analyze-cube.js\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fanalyze-cube&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Canalyze-cube.js&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();